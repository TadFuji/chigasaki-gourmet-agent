# グルメ検索エージェント

MCP（Model Context Protocol）を使用した、指定された地域のレストラン検索システムです。
茅ヶ崎市、藤沢市、平塚市、寒川町、新宿区など、任意の地域名を指定してグルメスポットを検索できます。

## 概要

このアプリケーションは、MCPアーキテクチャのデモンストレーションとして実装されています：

1. **MCPサーバー** (`server.py`): Google Maps Places APIをラップして、グルメ検索用のツールを提供します。
2. **MCPクライアント** (`client.py`): サーバーに接続し、検索クエリを実行して結果を表示します。

## 必要な環境

- Python 3.10以上
- Google Maps Places APIのAPIキー

## セットアップ手順

### 1. 依存パッケージのインストール

```bash
cd chigasaki-gourmet-agent
pip install -r requirements.txt
```

### 2. Google Maps APIキーの取得

1. [Google Cloud Console](https://console.cloud.google.com/) にアクセス
2. 新しいプロジェクトを作成（または既存のプロジェクトを選択）
3. 「APIとサービス」>「ライブラリ」から「Places API」を有効化
4. 「APIとサービス」>「認証情報」からAPIキーを作成

### 3. 環境変数の設定

`env.example`を`.env`にコピーし、APIキーを設定してください：

```bash
# Windows (PowerShell)
Copy-Item env.example .env

# macOS/Linux
cp env.example .env
```

`.env`ファイルを編集：

```
MAPS_API_KEY=your_actual_api_key_here
```

## 実行方法

### サーバーの単体テスト（オプション）

サーバーを直接実行することもできますが、通常はクライアントから自動的に起動されます。

```bash
python server.py
```

### エージェントの実行（推奨）

クライアントを実行すると、自動的にサーバーが起動され、検索が実行されます：

```bash
# 基本的な使い方（デフォルト: 茅ヶ崎市でランチを検索）
python client.py

# 地域名を指定（例: 藤沢市）
python client.py 藤沢市

# 地域名とクエリを指定（例: 平塚市でディナーを検索）
python client.py 平塚市 -q ディナー

# 最小評価を指定（例: 寒川町でカフェを検索、評価3.5以上）
python client.py 寒川町 -q カフェ -r 3.5

# 新宿区でランチを検索
python client.py 新宿区 -q ランチ
```

#### コマンドライン引数

- **位置引数（地域名）**: 検索する地域名（例: `茅ヶ崎市`, `藤沢市`, `平塚市`, `寒川町`, `新宿区`）
  - デフォルト: `茅ヶ崎市`
- **`-q, --query`**: 検索クエリ（例: `ランチ`, `ディナー`, `カフェ`）
  - デフォルト: `ランチ`
- **`-r, --min-rating`**: 最小評価（0.0〜5.0）
  - デフォルト: `4.0`

## 出力例

```
============================================================
グルメ検索エージェント
============================================================

📍 地域: 藤沢市
🔍 検索クエリ: ランチ
⭐ 最小評価: 4.0以上

✅ 検索完了: 藤沢市で5件のスポットが見つかりました

------------------------------------------------------------

📍 1. レストラン名
   ⭐ 評価: 4.5 (123件のレビュー)
   📍 住所: 神奈川県藤沢市...

------------------------------------------------------------
```

## アーキテクチャの説明

### MCPサーバー (`server.py`)

- `list_tools()`: サーバーが提供するツールのリストを返します（`search_places`）
- `call_tool()`: クライアントからのツール呼び出しを処理します
- `handle_search_places()`: Google Maps Places APIを使用して場所を検索し、指定された評価以上の場所をフィルタリング
  - `location`パラメータ: 検索する地域名（必須）
  - `query`パラメータ: 検索クエリ（必須）
  - `min_rating`パラメータ: 最小評価（オプション、デフォルト4.0）

### MCPクライアント (`client.py`)

- サーバーに接続（stdio通信を使用）
- コマンドライン引数で地域名、クエリ、最小評価を指定
- `search_places`ツールを呼び出し
- 結果をパースして、ユーザーフレンドリーな日本語形式で出力

## トラブルシューティング

### APIキーエラー

```
ValueError: MAPS_API_KEY環境変数が設定されていません
```

→ `.env`ファイルが正しく設定されているか確認してください。

### 検索結果が0件

- 評価の閾値（`-r`オプション）を下げてみてください
- クエリ（`-q`オプション）を変更してみてください
- 地域名の表記を確認してください（例: 「茅ヶ崎市」と「茅ケ崎市」は異なる場合があります）

### 接続エラー

- `server.py`が正常に起動できるか確認
- Pythonのバージョンが3.10以上であることを確認
- 必要なパッケージがすべてインストールされているか確認

## ライセンス

このプロジェクトはデモンストレーション目的で作成されています。

